<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Dino Vocab — Learn Spanish!</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
html, body {
  width: 100%; height: 100%;
  overflow: hidden;
  background: #1a1a2e;
}
body {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  font-family: 'Fredoka', sans-serif;
  touch-action: none;
  -webkit-user-select: none;
  user-select: none;
}
canvas {
  display: block;
  width: 100vw;
  height: 100vh;
  cursor: pointer;
}
</style>
</head>
<body>
<canvas id="c"></canvas>
<script>
// ═══════════════════════════════════════════════
//  DINO VOCAB — Learn Spanish while you run!
// ═══════════════════════════════════════════════

const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');

// Responsive canvas — HiDPI aware for crisp text
const W = 1200, H = 520;
const dpr = window.devicePixelRatio || 1;
canvas.width = W * dpr;
canvas.height = H * dpr;
canvas.style.width = '100vw';
canvas.style.height = '100vh';
ctx.scale(dpr, dpr);

// ── CONFIG ──────────────────────────────────────
const GROUND_Y   = 430;
const GRAVITY    = 0.12;
const JUMP_VEL   = -9;
const BASE_SPEED = 2;
const SPEED_INC  = 0.1;
const MAX_SPEED  = 4;
const LEARN_GAP  = 1450;
const QUIZ_LEAD  = 1200;
const QUIZ_GAP   = 1050;
const CELEBRATE_DUR = 100;

// Scale factor for sprites (original was built for 800x300)
const S = 1.6;

// ── VOCABULARY ──────────────────────────────────
const VOCAB = [
  { word: 'hola',      meaning: 'hello' },
  { word: 'adiós',     meaning: 'goodbye' },
  { word: 'gracias',   meaning: 'thank you' },
  { word: 'por favor', meaning: 'please' },
  { word: 'gato',      meaning: 'cat' },
  { word: 'perro',     meaning: 'dog' },
  { word: 'casa',      meaning: 'house' },
  { word: 'agua',      meaning: 'water' },
  { word: 'sol',       meaning: 'sun' },
  { word: 'luna',      meaning: 'moon' },
  { word: 'libro',     meaning: 'book' },
  { word: 'rojo',      meaning: 'red' },
  { word: 'verde',     meaning: 'green' },
  { word: 'azul',      meaning: 'blue' },
  { word: 'grande',    meaning: 'big' },
  { word: 'pequeño',   meaning: 'small' },
  { word: 'bueno',     meaning: 'good' },
  { word: 'malo',      meaning: 'bad' },
  { word: 'comer',     meaning: 'to eat' },
  { word: 'beber',     meaning: 'to drink' },
  { word: 'dormir',    meaning: 'to sleep' },
  { word: 'hablar',    meaning: 'to speak' },
  { word: 'amigo',     meaning: 'friend' },
  { word: 'comida',    meaning: 'food' },
  { word: 'tiempo',    meaning: 'time' },
  { word: 'ciudad',    meaning: 'city' },
  { word: 'trabajo',   meaning: 'work' },
  { word: 'noche',     meaning: 'night' },
  { word: 'día',       meaning: 'day' },
  { word: 'feliz',     meaning: 'happy' },
  { word: 'triste',    meaning: 'sad' },
  { word: 'bonito',    meaning: 'pretty' },
  { word: 'fuerte',    meaning: 'strong' },
  { word: 'nuevo',     meaning: 'new' },
  { word: 'viejo',     meaning: 'old' },
  { word: 'estrella',  meaning: 'star' },
  { word: 'corazón',   meaning: 'heart' },
  { word: 'montaña',   meaning: 'mountain' },
  { word: 'ventana',   meaning: 'window' },
  { word: 'camino',    meaning: 'path' },
];

// ── STATE ───────────────────────────────────────
let state = 'menu';
let score = 0, round = 0, speed = BASE_SPEED;
let wordsLearned = 0;
let frame = 0, roundStartFrame = 0;

const dino = { x: 120, y: GROUND_Y, w: Math.round(44*S), h: Math.round(47*S), vy: 0, grounded: true, runFrame: 0 };
let hurdles = [];
let roundData = {};
let usedWords = new Set();

// Sky text
let sky = { main: '', sub: '', alpha: 0, targetAlpha: 0, color: '#1a5276' };

// Floating texts
let floats = [];

// Screen flash
let flash = { color: '#fff', alpha: 0 };

// Dust particles
let dust = [];

// Ground dashes
const groundDashes = [];
for (let i = 0; i < 60; i++) groundDashes.push({ x: i * 25 + Math.random() * 10, w: 10 + Math.random() * 20 });

// Clouds
const clouds = [];
for (let i = 0; i < 8; i++) clouds.push({ x: Math.random() * W, y: 40 + Math.random() * 80, w: 60 + Math.random() * 80 });

// Background hills
const hills = [];
for (let i = 0; i < 12; i++) hills.push({ x: i * 130 + Math.random() * 40, h: 40 + Math.random() * 60, w: 100 + Math.random() * 80 });

// ── UTILITIES ───────────────────────────────────
function shuffle(a) {
  const b = [...a];
  for (let i = b.length - 1; i > 0; i--) { const j = Math.random() * (i + 1) | 0; [b[i], b[j]] = [b[j], b[i]]; }
  return b;
}

function setSky(main, sub, alpha, color) {
  sky.main = main; sky.sub = sub; sky.targetAlpha = alpha; sky.color = color || '#1a5276';
}

function doFlash(color) { flash.color = color; flash.alpha = 0.3; }

function addFloat(text, x, y, color) {
  floats.push({ text, x, y, alpha: 1.2, color: color || '#1a5276' });
}

function addDust() {
  for (let i = 0; i < 5; i++) {
    dust.push({
      x: dino.x + 10 + Math.random() * 20,
      y: GROUND_Y - 2,
      vx: -1 - Math.random() * 2,
      vy: -Math.random() * 2,
      life: 20 + Math.random() * 15,
      size: 2 + Math.random() * 3,
    });
  }
}

// ── ROUND SETUP ─────────────────────────────────
function pickWords() {
  let pool = VOCAB.filter(v => !usedWords.has(v.word));
  if (pool.length < 2) { usedWords.clear(); pool = [...VOCAB]; }
  const picked = shuffle(pool).slice(0, 2);
  picked.forEach(w => usedWords.add(w.word));
  return picked;
}

const HW = Math.round(20 * S);   // hurdle width
const HH = Math.round(28 * S);   // hurdle height

function setupRound() {
  round++;
  speed = Math.min(BASE_SPEED + (round - 1) * SPEED_INC, MAX_SPEED);
  roundStartFrame = frame;

  const [w1, w2] = pickWords();
  const quizWord = Math.random() < 0.5 ? w1 : w2;
  const otherWord = quizWord === w1 ? w2 : w1;
  const correct = quizWord.meaning;

  const otherMeaning = otherWord.meaning;
  const pool = VOCAB.map(v => v.meaning).filter(m => m !== correct && m !== otherMeaning);
  const third = shuffle(pool)[0];
  const options = shuffle([correct, otherMeaning, third]);

  const sx = W + 280;
  hurdles = [
    { x: sx, w: HW, h: HH, type: 'learn', word: w1, passed: false, hit: false },
    { x: sx + LEARN_GAP, w: HW, h: HH, type: 'learn', word: w2, passed: false, hit: false },
    { x: sx + LEARN_GAP * 2 + QUIZ_LEAD, w: HW, h: HH, type: 'quiz', label: options[0], correct: options[0] === correct, passed: false, hit: false },
    { x: sx + LEARN_GAP * 2 + QUIZ_LEAD + QUIZ_GAP, w: HW, h: HH, type: 'quiz', label: options[1], correct: options[1] === correct, passed: false, hit: false },
    { x: sx + LEARN_GAP * 2 + QUIZ_LEAD + QUIZ_GAP * 2, w: HW, h: HH, type: 'quiz', label: options[2], correct: options[2] === correct, passed: false, hit: false },
  ];

  roundData = {
    word1: w1, word2: w2,
    quizWord, correctAnswer: correct, options,
    shownWords: [],
    question: `What does "${quizWord.word}" mean?`,
    phase: 'learn',
    celebrateTimer: 0,
    gameOverMsg: '',
  };

  setSky(`Round ${round}`, round === 1 ? 'Jump over hurdles to learn words!' : '', 1, '#546e7a');
}

// ── INPUT ───────────────────────────────────────
function onInput() {
  if (state === 'menu') { startGame(); return; }
  if (state === 'gameover') { startGame(); return; }
  if (state === 'playing' && dino.grounded) {
    dino.vy = JUMP_VEL;
    dino.grounded = false;
    addDust();
  }
}

document.addEventListener('keydown', e => {
  if (e.code === 'Space' || e.code === 'ArrowUp') { e.preventDefault(); onInput(); }
});
canvas.addEventListener('click', e => { e.preventDefault(); onInput(); });
canvas.addEventListener('touchstart', e => { e.preventDefault(); onInput(); });

// ── GAME CONTROL ────────────────────────────────
function startGame() {
  state = 'playing';
  score = 0; round = 0; wordsLearned = 0; frame = 0;
  speed = BASE_SPEED;
  dino.y = GROUND_Y; dino.vy = 0; dino.grounded = true; dino.runFrame = 0;
  hurdles = []; floats = []; dust = [];
  usedWords.clear();
  flash.alpha = 0;
  setupRound();
}

function gameOver(msg) {
  state = 'gameover';
  roundData.gameOverMsg = msg || 'Game Over!';
}

// ── COLLISION ───────────────────────────────────
function collides(d, h) {
  const dl = d.x + 14, dr = d.x + d.w - 10;
  const dt = d.y - d.h + 12, db = d.y;
  const hl = h.x + 4, hr = h.x + h.w - 4;
  const ht = GROUND_Y - h.h + 4, hb = GROUND_Y;
  return dr > hl && dl < hr && db > ht && dt < hb;
}

// ── UPDATE ──────────────────────────────────────
function update() {
  if (state !== 'playing') return;
  frame++;
  dino.runFrame++;

  // Physics
  if (!dino.grounded) {
    dino.vy += GRAVITY;
    dino.y += dino.vy;
    if (dino.y >= GROUND_Y) {
      dino.y = GROUND_Y;
      dino.vy = 0;
      dino.grounded = true;
      addDust();
    }
  }

  // Move objects
  for (const h of hurdles) h.x -= speed;
  for (const d of groundDashes) { d.x -= speed; if (d.x + d.w < 0) { d.x = W + Math.random() * 30; d.w = 10 + Math.random() * 20; } }
  for (const c of clouds) { c.x -= speed * 0.12; if (c.x + c.w < -30) { c.x = W + 60 + Math.random() * 100; c.y = 40 + Math.random() * 80; } }
  for (const h of hills) { h.x -= speed * 0.3; if (h.x + h.w < -20) { h.x = W + 40 + Math.random() * 60; h.h = 40 + Math.random() * 60; h.w = 100 + Math.random() * 80; } }

  // Dust
  dust = dust.filter(d => { d.x += d.vx; d.y += d.vy; d.vy += 0.1; d.life--; return d.life > 0; });

  // Floating texts
  floats = floats.filter(f => { f.y -= 0.8; f.alpha -= 0.012; return f.alpha > 0; });

  // Flash fade
  if (flash.alpha > 0) flash.alpha -= 0.01;

  // Sky interpolation
  sky.alpha += (sky.targetAlpha - sky.alpha) * 0.07;

  // Celebrate phase
  if (roundData.phase === 'celebrate') {
    roundData.celebrateTimer--;
    if (roundData.celebrateTimer <= 0) setupRound();
    score += speed * 0.01;
    return;
  }

  // Hurdle interactions
  for (const h of hurdles) {
    if (h.passed || h.hit) continue;
    if (collides(dino, h)) {
      h.hit = true;
      if (h.type === 'learn') {
        doFlash('#c0392b');
        gameOver('Oops! Jump over green hurdles to learn words!');
        return;
      } else {
        if (h.correct) {
          score += 100;
          wordsLearned += 2;
          roundData.phase = 'celebrate';
          roundData.celebrateTimer = CELEBRATE_DUR;
          hurdles = hurdles.filter(hh => hh.hit);
          setSky('Correct!', `${roundData.quizWord.word} = ${roundData.correctAnswer}`, 1, '#2e7d32');
          doFlash('#4caf50');
          addFloat('+100', dino.x + 40, dino.y - 90, '#2e7d32');
          return;
        } else {
          doFlash('#c0392b');
          gameOver(`Wrong! "${roundData.quizWord.word}" = ${roundData.correctAnswer}`);
          return;
        }
      }
    }
    if (h.x + h.w < dino.x - 5) {
      h.passed = true;
      if (h.type === 'learn') {
        roundData.shownWords.push(h.word);
        addFloat(`${h.word.word} = ${h.word.meaning}`, W / 2, 160, '#1565c0');
      }
    }
  }

  // All quiz hurdles skipped
  const quizH = hurdles.filter(h => h.type === 'quiz');
  if (quizH.length > 0 && quizH.every(h => h.passed)) {
    doFlash('#c0392b');
    gameOver(`You skipped all answers! "${roundData.quizWord.word}" = ${roundData.correctAnswer}`);
    return;
  }

  updateSky();
  score += speed * 0.008;
}

function updateSky() {
  const learnPassed = roundData.shownWords.length;
  const firstQuiz = hurdles.find(h => h.type === 'quiz' && !h.passed && !h.hit);
  const quizVisible = firstQuiz && firstQuiz.x < W + 30;

  if (quizVisible || roundData.phase === 'quiz') {
    setSky(roundData.question, 'Crash into the correct answer!', 1, '#c62828');
    roundData.phase = 'quiz';
  } else if (learnPassed >= 2) {
    const a = roundData.word1, b = roundData.word2;
    setSky(`${a.word} = ${a.meaning}     ${b.word} = ${b.meaning}`, 'Quiz coming up — remember these!', 1, '#1565c0');
  } else if (learnPassed === 1) {
    const w = roundData.shownWords[0];
    setSky(`${w.word}  =  ${w.meaning}`, '', 1, '#1565c0');
  } else if (frame - roundStartFrame < 100) {
    // Round intro still showing
  } else {
    setSky('', '', 0, '#546e7a');
  }
}

// ── DRAWING ─────────────────────────────────────

function drawBackground() {
  // Sky gradient
  const grad = ctx.createLinearGradient(0, 0, 0, GROUND_Y);
  if (roundData.phase === 'quiz') {
    grad.addColorStop(0, '#fff5f5');
    grad.addColorStop(1, '#fff0ee');
  } else {
    grad.addColorStop(0, '#e3f2fd');
    grad.addColorStop(1, '#fafafa');
  }
  ctx.fillStyle = grad;
  ctx.fillRect(0, 0, W, GROUND_Y);

  // Ground fill
  ctx.fillStyle = '#f5f0e8';
  ctx.fillRect(0, GROUND_Y, W, H - GROUND_Y);
}

function drawHills() {
  ctx.fillStyle = '#e8e0d4';
  for (const h of hills) {
    ctx.beginPath();
    ctx.moveTo(h.x, GROUND_Y);
    ctx.quadraticCurveTo(h.x + h.w / 2, GROUND_Y - h.h, h.x + h.w, GROUND_Y);
    ctx.fill();
  }
}

function drawClouds() {
  for (const c of clouds) {
    ctx.fillStyle = 'rgba(255,255,255,0.85)';
    ctx.beginPath(); ctx.ellipse(c.x, c.y, c.w * 0.45, 16, 0, 0, Math.PI * 2); ctx.fill();
    ctx.beginPath(); ctx.ellipse(c.x - c.w * 0.25, c.y + 6, c.w * 0.32, 13, 0, 0, Math.PI * 2); ctx.fill();
    ctx.beginPath(); ctx.ellipse(c.x + c.w * 0.28, c.y + 4, c.w * 0.3, 12, 0, 0, Math.PI * 2); ctx.fill();
  }
}

function drawGround() {
  // Main ground line
  ctx.fillStyle = '#8d6e63';
  ctx.fillRect(0, GROUND_Y - 1, W, 3);
  // Texture dashes
  ctx.fillStyle = '#c8b8a8';
  for (const d of groundDashes) ctx.fillRect(d.x, GROUND_Y + 10 + (d.x * 3 % 4), d.w, 2);
  ctx.fillStyle = '#d8caba';
  for (const d of groundDashes) if (d.x % 3 === 0) ctx.fillRect(d.x + 8, GROUND_Y + 20 + (d.x * 5 % 6), d.w * 0.6, 1);
}

function drawDust() {
  for (const d of dust) {
    ctx.fillStyle = `rgba(180,160,140,${d.life / 35})`;
    ctx.beginPath();
    ctx.arc(d.x, d.y, d.size, 0, Math.PI * 2);
    ctx.fill();
  }
}

function drawDino() {
  const bx = dino.x, by = dino.y - dino.h;
  ctx.fillStyle = '#37474f';

  // Head
  ctx.fillRect(bx + 32*S, by, 24*S, 12*S);
  ctx.fillRect(bx + 22*S, by + 6*S, 30*S, 14*S);
  ctx.fillRect(bx + 38*S, by + 16*S, 20*S, 6*S);
  // Eye
  ctx.fillStyle = '#fff';
  ctx.fillRect(bx + 57*S, by + 4*S, 5*S, 5*S);
  ctx.fillStyle = '#37474f';
  // Body
  ctx.fillRect(bx + 10*S, by + 18*S, 28*S, 20*S);
  // Tail
  ctx.fillRect(bx, by + 22*S, 14*S, 7*S);
  ctx.fillRect(bx - 6*S, by + 27*S, 10*S, 5*S);
  // Arm
  ctx.fillRect(bx + 48*S, by + 28*S, 8*S, 4*S);
  ctx.fillRect(bx + 54*S, by + 30*S, 4*S, 6*S);
  // Legs
  if (!dino.grounded) {
    ctx.fillRect(bx + 18*S, by + 36*S, 9*S, 8*S);
    ctx.fillRect(bx + 38*S, by + 38*S, 9*S, 6*S);
  } else {
    const f = Math.floor(dino.runFrame / 5) % 2;
    ctx.fillRect(bx + 18*S, by + 38*S, 9*S, f ? 6*S : 10*S);
    ctx.fillRect(bx + 38*S, by + 38*S, 9*S, f ? 10*S : 6*S);
  }
}

function drawCactus(h) {
  const x = h.x, top = GROUND_Y - h.h;
  // Shadow
  ctx.fillStyle = 'rgba(0,0,0,0.06)';
  ctx.beginPath();
  ctx.ellipse(x + h.w / 2, GROUND_Y + 2, h.w * 0.7, 4, 0, 0, Math.PI * 2);
  ctx.fill();
  // Main
  ctx.fillStyle = '#43a047';
  ctx.fillRect(x + 10*S, top, 12*S, h.h);
  ctx.fillRect(x, top + 14*S, 10*S, 8*S);
  ctx.fillRect(x, top + 6*S, 6*S, 16*S);
  ctx.fillRect(x + 22*S, top + 22*S, 10*S, 8*S);
  ctx.fillRect(x + 28*S, top + 14*S, 6*S, 18*S);
  // Highlight
  ctx.fillStyle = '#66bb6a';
  ctx.fillRect(x + 14*S, top + 3, 4*S, h.h - 6);
}

function drawQuizCactus(h) {
  const x = h.x, top = GROUND_Y - h.h;
  // Shadow
  ctx.fillStyle = 'rgba(0,0,0,0.06)';
  ctx.beginPath();
  ctx.ellipse(x + h.w / 2, GROUND_Y + 2, h.w * 0.7, 4, 0, 0, Math.PI * 2);
  ctx.fill();
  // Main
  const baseColor = h.hit ? (h.correct ? '#2e7d32' : '#c62828') : '#6d4c41';
  const hiColor   = h.hit ? (h.correct ? '#43a047' : '#e53935') : '#8d6e63';
  ctx.fillStyle = baseColor;
  ctx.fillRect(x + 10*S, top, 12*S, h.h);
  ctx.fillRect(x, top + 14*S, 10*S, 8*S);
  ctx.fillRect(x, top + 6*S, 6*S, 16*S);
  ctx.fillRect(x + 22*S, top + 22*S, 10*S, 8*S);
  ctx.fillRect(x + 28*S, top + 14*S, 6*S, 18*S);
  ctx.fillStyle = hiColor;
  ctx.fillRect(x + 14*S, top + 3, 4*S, h.h - 6);

  // Floating label
  if (!h.passed && !h.hit && h.x < W) {
    // Background pill
    ctx.font = 'bold 26px "Fredoka", sans-serif';
    const tw = ctx.measureText(h.label).width;
    const px = 18, py = 8;
    const lx = x + h.w / 2, ly = top - 30;
    ctx.fillStyle = 'rgba(255,255,255,0.92)';
    ctx.beginPath();
    ctx.roundRect(lx - tw / 2 - px, ly - 16 - py, tw + px * 2, 32 + py, 12);
    ctx.fill();
    ctx.strokeStyle = '#8d6e63';
    ctx.lineWidth = 2;
    ctx.stroke();
    // Text
    ctx.fillStyle = '#4e342e';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(h.label, lx, ly);
    ctx.textAlign = 'left';
    ctx.textBaseline = 'alphabetic';
  }
}

function drawSkyText() {
  if (sky.alpha < 0.02) return;
  ctx.save();
  ctx.globalAlpha = Math.min(sky.alpha, 1);
  ctx.textAlign = 'center';

  // Main text with subtle shadow
  ctx.fillStyle = 'rgba(0,0,0,0.08)';
  ctx.font = 'bold 36px "Fredoka", sans-serif';
  ctx.fillText(sky.main, W / 2 + 1, 62);
  ctx.fillStyle = sky.color;
  ctx.fillText(sky.main, W / 2, 60);

  if (sky.sub) {
    ctx.font = '22px "Fredoka", sans-serif';
    ctx.fillStyle = sky.color === '#c62828' ? '#e57373' : '#78909c';
    ctx.fillText(sky.sub, W / 2, 92);
  }

  ctx.textAlign = 'left';
  ctx.restore();
}

function drawFloats() {
  for (const f of floats) {
    ctx.save();
    ctx.globalAlpha = Math.min(f.alpha, 1);
    ctx.fillStyle = f.color;
    ctx.font = 'bold 28px "Fredoka", sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText(f.text, f.x, f.y);
    ctx.restore();
  }
  ctx.textAlign = 'left';
}

function drawFlash() {
  if (flash.alpha <= 0) return;
  ctx.save();
  ctx.globalAlpha = flash.alpha;
  ctx.fillStyle = flash.color;
  ctx.fillRect(0, 0, W, H);
  ctx.restore();
}

function drawHUD() {
  // Score pill — top left
  drawPill(16, 14, `Score  ${Math.floor(score)}`, '#546e7a');
  // Round pill — top right
  drawPill(W - 16 - measurePill(`Round ${round}`), 14, `Round ${round}`, '#546e7a');
  // Words pill — below round
  drawPill(W - 16 - measurePill(`Words  ${wordsLearned}`), 52, `Words  ${wordsLearned}`, '#7e57c2');
}

function measurePill(text) {
  ctx.font = 'bold 18px "Fredoka", sans-serif';
  return ctx.measureText(text).width + 28;
}

function drawPill(x, y, text, color) {
  ctx.font = 'bold 18px "Fredoka", sans-serif';
  const tw = ctx.measureText(text).width;
  const pw = tw + 28, ph = 30;
  ctx.fillStyle = 'rgba(255,255,255,0.75)';
  ctx.beginPath();
  ctx.roundRect(x, y, pw, ph, 15);
  ctx.fill();
  ctx.fillStyle = color;
  ctx.textBaseline = 'middle';
  ctx.fillText(text, x + 14, y + ph / 2);
  ctx.textBaseline = 'alphabetic';
}

function drawPhaseIndicator() {
  if (roundData.phase === 'quiz') {
    // Subtle red border glow
    ctx.save();
    ctx.strokeStyle = 'rgba(198,40,40,0.25)';
    ctx.lineWidth = 6;
    ctx.strokeRect(3, 3, W - 6, H - 6);
    // Bottom bar
    ctx.fillStyle = 'rgba(198,40,40,0.85)';
    ctx.beginPath();
    ctx.roundRect(W / 2 - 240, H - 44, 480, 36, 18);
    ctx.fill();
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 17px "Fredoka", sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('QUIZ MODE — Crash into the right answer!', W / 2, H - 26);
    ctx.textAlign = 'left';
    ctx.textBaseline = 'alphabetic';
    ctx.restore();
  }
}

// ── MENU SCREEN ─────────────────────────────────
function drawMenu() {
  // Background
  const grad = ctx.createLinearGradient(0, 0, 0, H);
  grad.addColorStop(0, '#e3f2fd');
  grad.addColorStop(0.7, '#fafafa');
  grad.addColorStop(1, '#f5f0e8');
  ctx.fillStyle = grad;
  ctx.fillRect(0, 0, W, H);

  drawHills();
  drawClouds();
  drawGround();

  // Static dino
  dino.y = GROUND_Y; dino.grounded = true; dino.runFrame = 0;
  drawDino();

  // Static cacti
  drawCactus({ x: 420, w: HW, h: HH });
  drawQuizCactus({ x: 680, w: HW, h: HH, label: 'hello', correct: false, passed: false, hit: false });

  ctx.textAlign = 'center';

  // Title
  ctx.fillStyle = '#263238';
  ctx.font = 'bold 56px "Fredoka", sans-serif';
  ctx.fillText('DINO VOCAB', W / 2, 80);

  // Subtitle
  ctx.font = '26px "Fredoka", sans-serif';
  ctx.fillStyle = '#78909c';
  ctx.fillText('Learn Spanish while you run!', W / 2, 118);

  // Instructions card
  const cw = 520, ch = 160, cx = (W - cw) / 2, cy = 145;
  ctx.fillStyle = 'rgba(255,255,255,0.8)';
  ctx.beginPath();
  ctx.roundRect(cx, cy, cw, ch, 16);
  ctx.fill();

  ctx.font = '20px "Fredoka", sans-serif';
  ctx.fillStyle = '#546e7a';
  const instructions = [
    '1.  Jump over green hurdles to learn words',
    '2.  A quiz appears with 3 answer hurdles',
    '3.  CRASH into the correct answer to survive',
    '4.  Wrong crash or skipping all = Game Over',
  ];
  instructions.forEach((line, i) => {
    ctx.fillText(line, W / 2, cy + 36 + i * 32);
  });

  // Start button
  const bw = 340, bh = 52, bxx = (W - bw) / 2, byy = 330;
  const pulse = 0.92 + 0.08 * Math.sin(Date.now() / 300);
  ctx.save();
  ctx.translate(W / 2, byy + bh / 2);
  ctx.scale(pulse, pulse);
  ctx.translate(-W / 2, -(byy + bh / 2));
  ctx.fillStyle = '#43a047';
  ctx.beginPath();
  ctx.roundRect(bxx, byy, bw, bh, 26);
  ctx.fill();
  ctx.fillStyle = '#fff';
  ctx.font = 'bold 24px "Fredoka", sans-serif';
  ctx.fillText('Press SPACE or tap to start', W / 2, byy + 33);
  ctx.restore();

  ctx.textAlign = 'left';
}

// ── GAME OVER SCREEN ────────────────────────────
function drawGameOver() {
  // Dim overlay
  ctx.fillStyle = 'rgba(0,0,0,0.45)';
  ctx.fillRect(0, 0, W, H);

  // Modal card
  const cw = 560, ch = 260, cx = (W - cw) / 2, cy = (H - ch) / 2 - 20;
  ctx.fillStyle = '#fff';
  ctx.shadowColor = 'rgba(0,0,0,0.2)';
  ctx.shadowBlur = 30;
  ctx.beginPath();
  ctx.roundRect(cx, cy, cw, ch, 20);
  ctx.fill();
  ctx.shadowBlur = 0;

  ctx.textAlign = 'center';

  // Title
  ctx.fillStyle = '#c62828';
  ctx.font = 'bold 38px "Fredoka", sans-serif';
  ctx.fillText('GAME OVER', W / 2, cy + 52);

  // Message
  ctx.fillStyle = '#546e7a';
  ctx.font = '20px "Fredoka", sans-serif';
  ctx.fillText(roundData.gameOverMsg || '', W / 2, cy + 95);

  // Stats
  ctx.fillStyle = '#263238';
  ctx.font = 'bold 22px "Fredoka", sans-serif';
  ctx.fillText(`Score: ${Math.floor(score)}     Words: ${wordsLearned}     Rounds: ${Math.max(round - 1, 0)}`, W / 2, cy + 145);

  // Retry button
  const bw = 320, bh = 48, bxx = (W - bw) / 2, byy = cy + 175;
  ctx.fillStyle = '#43a047';
  ctx.beginPath();
  ctx.roundRect(bxx, byy, bw, bh, 24);
  ctx.fill();
  ctx.fillStyle = '#fff';
  ctx.font = 'bold 22px "Fredoka", sans-serif';
  ctx.fillText('Press SPACE or tap to retry', W / 2, byy + 31);

  ctx.textAlign = 'left';
}

// ── RENDER ──────────────────────────────────────
function render() {
  ctx.clearRect(0, 0, W, H);

  if (state === 'menu') { drawMenu(); return; }

  drawBackground();
  drawHills();
  drawClouds();
  drawSkyText();
  drawGround();

  // Hurdles
  for (const h of hurdles) {
    if (h.x > W + 80 || h.x + h.w < -80) continue;
    if (h.type === 'learn') drawCactus(h);
    else drawQuizCactus(h);
  }

  drawDust();
  drawDino();
  drawFloats();
  drawPhaseIndicator();
  drawHUD();
  drawFlash();

  if (state === 'gameover') drawGameOver();
}

// ── MAIN LOOP ───────────────────────────────────
function loop() {
  update();
  render();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
